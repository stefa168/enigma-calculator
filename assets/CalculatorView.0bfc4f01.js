import{d as G,r as m,o as H,C as oe,w as j,a as k,c as C,_ as se,u as le,b as F,e as ne,f as e,g as R,h as W,v as J,t as u,i as S,j as ce,F as T,k as Z,p as ie,l as re,m as A,n as ue}from"./index.98172d96.js";const de={alta:-15,nessuna:0,leggera:25,pesante:50},q=G({__name:"BarChart",props:{data:null},setup(V){const b=V,c=m(void 0);let i;return H(()=>{if(c.value===void 0)return;const v="#E3E3E3",_="#464646";i=new oe(c.value,{type:"bar",data:{labels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],datasets:[]},options:{color:v,borderColor:_,responsive:!0,scales:{y:{ticks:{color:v},beginAtZero:!0,suggestedMax:100,suggestedMin:0,grid:{color:_}},x:{ticks:{color:v},grid:{color:_}}},plugins:{datalabels:{anchor:"end",align:"end",offset:2,color:v}}}})}),j(()=>b.data,()=>{i!==void 0&&(i.data.datasets=b.data,i.update("active"))}),(v,_)=>(k(),C("canvas",{ref_key:"chartDOMElement",ref:c},null,512))}});const r=V=>(ie("data-v-534e894e"),V=V(),re(),V),pe={class:"container"},ve={class:"row"},_e={class:"col-6"},he={class:"mb-4"},me=r(()=>e("h2",{class:"text-center"},"Scegli un attaccante",-1)),be={class:"mb-4"},ge=r(()=>e("h2",null,"Dettagli personaggio",-1)),fe=r(()=>e("span",{class:"h4"},"Nome:",-1)),De=A(),ke={class:"ps-3"},Ce=r(()=>e("span",{class:"h4"},"Armatura:",-1)),Ae=A(),xe={class:"ps-3"},ye=r(()=>e("span",{class:"h4"},"Competenza Attacco:",-1)),Ve=A(),ze={class:"ps-3"},we=r(()=>e("span",{class:"h4"},"Competenza Difesa:",-1)),Pe=A(),Me={class:"ps-3"},Ee=r(()=>e("span",{class:"h4"},"Resistenza al danno:",-1)),Fe={class:"ps-3"},Se=r(()=>e("span",{class:"h4"},"Armi:",-1)),Re={key:0},We={key:1},Ne={class:"form-check"},Ie=r(()=>e("label",{class:"form-check-label",for:"attackerAllWeaponsCheckbox"},"Mostra tutte le armi",-1)),Ue={class:"row justify-content-center"},Be={class:"col-sm-10 col-md-10 col-lg-8 col-xl-8 col-xxl-8"},je={class:"row mt-4"},Le={class:"col-6"},Oe={class:"mb-4"},$e=r(()=>e("h2",{class:"text-center"},"Scegli un difensore",-1)),Je=r(()=>e("h2",null,"Dettagli personaggio",-1)),Te=r(()=>e("span",{class:"h4"},"Nome:",-1)),Ze=A(),qe={class:"ps-3"},Ge=r(()=>e("span",{class:"h4"},"Armatura:",-1)),He=A(),Ke={class:"ps-3"},Qe=r(()=>e("span",{class:"h4"},"Competenza Attacco:",-1)),Xe=A(),Ye={class:"ps-3"},ea=r(()=>e("span",{class:"h4"},"Competenza Difesa:",-1)),aa=A(),ta={class:"ps-3"},oa=r(()=>e("span",{class:"h4"},"Resistenza al danno:",-1)),sa={class:"ps-3"},la=r(()=>e("span",{class:"h4"},"Copertura:",-1)),na=["value"],ca={class:"form-check-label"},ia={class:"row justify-content-center"},ra={class:"col-sm-10 col-md-10 col-lg-8 col-xl-8 col-xxl-8"},ua={class:"table table-dark table-striped mt-4",id:"tabDanni"},da=r(()=>e("thead",null,[e("tr",null,[e("th",null,"Risultato dadi"),e("th",null,"Danno effettivo"),e("th",null,"Probabilit\xE0")])],-1)),pa=G({__name:"CalculatorView",setup(V){const b=m(void 0),c=m(null),i=m(null),v=m(!1),_=le();j(()=>_.isDataLoaded,L),H(L);function L(){N.value=_.getArmi,I.value=_.getPersonaggi,U.value=_.getArmature}const N=m([]),I=m([]),U=m([]),B=F(()=>{if(c.value==null)return[];if(v.value)return N.value;const t=[];return c.value.armi.forEach(s=>{const p=N.value.find(h=>h.codice==s.arma);p!==void 0&&t.push(p)}),t}),d=m(null);j(c,()=>{d.value=B.value[0]});function K(t,s,p,h){var g,f,D;const z=[.7,.7375,.775,.8125,.85,.8875,.925,.9625],x=U.value.find(a=>a.codice==p.armatura);if(!x)throw`Armatura difensore non trovata ${p.armatura}`;const w=t.tipoDanno,P=t.gravitaDanno,M=(D=(f=(g=x.gravitaDanno)==null?void 0:g[P])==null?void 0:f[w][0])!=null?D:0,y=new Array(30);for(let a=0;a<30;a++)a<8&&t.tipoDanno=="perforante"?y[a]=Math.round(t.probabilita[a]*(100+5*(s.competenzaAttacco-p.competenzaDifesa)-M*z[a]-h)/100):y[a]=Math.round(t.probabilita[a]*(100+5*(s.competenzaAttacco-p.competenzaDifesa)-M-h)/100);return y.map(Q)}const Q=t=>Math.min(99,Math.max(1,t)),X=F(()=>{var t;return(t=d.value)==null?void 0:t.probabilita}),Y=F(()=>{var t;return[{label:"Probabilit\xE0 di colpire base dell'arma",data:(t=X.value)!=null?t:[],backgroundColor:["rgba(54, 162, 235, 0.8)"],borderColor:["rgba(54, 162, 235, 1)"],borderWidth:1}]}),ee=F(()=>{if(d.value!==null&&c.value!==null&&i.value!==null&&b.value!==void 0)return K(d.value,c.value,i.value,b.value)}),ae=F(()=>{var g,f,D;if(d.value===null)return[];if(c.value===null)return[];if(i.value===null)return[];if(b.value===void 0)return[];const t=i.value.armatura,s=U.value.find(a=>a.codice==t);d.value.danno.reduce((a,l)=>a+l,0);const p=d.value.danno.length,h=d.value.danno.reduce((a,l)=>a*l,1),z=d.value.tipoDanno,x=d.value.gravitaDanno,w=(D=(f=(g=s==null?void 0:s.gravitaDanno)==null?void 0:g[x])==null?void 0:f[z][0])!=null?D:0,P=(a,l)=>a.length>l.length?a.map((n,o)=>o<l.length?a[o]+l[o]:a[o]):l.map((n,o)=>o<a.length?a[o]+l[o]:l[o]);return(a=>a.reduce((l,n)=>l.reduceRight((o,E)=>[0,...P(Array(n).fill(E),o)],[]),[1]))(d.value.danno).map(a=>a/h*100).map((a,l)=>({diceResult:l,probability:a})).filter(a=>a.probability>0).map((a,l)=>{var o,E,O,$;const n=Math.max(0,(l+p)*(100-w)/100-(($=(O=(E=(o=i.value)==null?void 0:o.statistiche)==null?void 0:E.ossatura)==null?void 0:O[1])!=null?$:0));return{probability:a,effectiveDamage:n}})}),te=F(()=>{var t;return[{label:"Probabilit\xE0 di colpire",data:(t=ee.value)!=null?t:[],backgroundColor:["rgba(54, 162, 235, 0.8)"],borderColor:["rgba(54, 162, 235, 1)"],borderWidth:1}]});return(t,s)=>{var h,z,x,w,P,M,y,g,f,D,a,l;const p=ne("v-select");return k(),C("div",pe,[e("div",ve,[e("div",_e,[e("div",he,[me,R(p,{options:I.value,label:"nome",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=n=>c.value=n)},null,8,["options","modelValue"])]),W(e("div",be,[ge,e("div",null,[fe,De,e("span",ke,u((h=c.value)==null?void 0:h.nome),1)]),e("div",null,[Ce,Ae,e("span",xe,u((z=c.value)==null?void 0:z.armatura),1)]),e("div",null,[ye,Ve,e("span",ze,u((x=c.value)==null?void 0:x.competenzaAttacco),1)]),e("div",null,[we,Pe,e("span",Me,u((w=c.value)==null?void 0:w.competenzaDifesa),1)]),e("div",null,[Ee,e("span",Fe,u((M=(P=c.value)==null?void 0:P.resistenzaAlDanno)!=null?M:0),1)]),e("div",null,[Se,S(B).length===0?(k(),C("div",Re,"Il personaggio non ha armi")):(k(),C("div",We,[R(p,{options:S(B),label:"nome",modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=n=>d.value=n)},null,8,["options","modelValue"])])),e("div",Ne,[W(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"attackerAllWeaponsCheckbox","onUpdate:modelValue":s[2]||(s[2]=n=>v.value=n)},null,512),[[ce,v.value]]),Ie])])],512),[[J,c.value]])])]),e("div",Ue,[e("div",Be,[R(q,{data:S(Y)},null,8,["data"])])]),e("div",je,[e("div",Le,[e("div",Oe,[$e,R(p,{options:I.value,label:"nome",modelValue:i.value,"onUpdate:modelValue":s[3]||(s[3]=n=>i.value=n)},null,8,["options","modelValue"])]),W(e("div",null,[Je,e("div",null,[Te,Ze,e("span",qe,u((y=i.value)==null?void 0:y.nome),1)]),e("div",null,[Ge,He,e("span",Ke,u((g=i.value)==null?void 0:g.armatura),1)]),e("div",null,[Qe,Xe,e("span",Ye,u((f=i.value)==null?void 0:f.competenzaAttacco),1)]),e("div",null,[ea,aa,e("span",ta,u((D=i.value)==null?void 0:D.competenzaDifesa),1)]),e("div",null,[oa,e("span",sa,u((l=(a=i.value)==null?void 0:a.resistenzaAlDanno)!=null?l:0),1)]),e("div",null,[la,e("div",null,[(k(!0),C(T,null,Z(S(de),(n,o)=>(k(),C("div",{class:"form-check",key:o},[W(e("input",{class:"form-check-input",type:"radio",value:n,"onUpdate:modelValue":s[4]||(s[4]=E=>b.value=E)},null,8,na),[[ue,b.value]]),e("label",ca,u(o==="pesante"?"Copertura pesante":o==="nessuna"?"Nessuna copertura":o==="leggera"?"Leggera copertura":o==="alta"?"Alta esposizione":""),1)]))),128))])])],512),[[J,i.value]])])]),e("div",ia,[e("div",ra,[R(q,{data:S(te)},null,8,["data"])])]),e("table",ua,[da,e("tbody",null,[(k(!0),C(T,null,Z(S(ae),(n,o)=>(k(),C("tr",{key:o},[e("td",null,u(parseFloat(n.probability.diceResult.toFixed(2))),1),e("td",null,u(parseFloat(n.effectiveDamage.toFixed(2))),1),e("td",null,u(parseFloat(n.probability.probability.toFixed(2)))+" %",1)]))),128))])])])}}});var _a=se(pa,[["__scopeId","data-v-534e894e"]]);export{_a as default};
